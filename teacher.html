<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guru Panel - Vue Edition</title>

    <!-- Dependencies -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.lordicon.com/lordicon.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link rel="stylesheet" href="">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }

        /* Transitions */
        .fade-enter-active,
        .fade-leave-active {
            transition: opacity 0.3s ease;
        }

        .fade-enter-from,
        .fade-leave-to {
            opacity: 0;
        }

        /* Slide Up Transition */
        .slide-up-enter-active,
        .slide-up-leave-active {
            transition: all 0.4s ease-out;
        }

        .slide-up-enter-from {
            opacity: 0;
            transform: translateY(20px);
        }

        .slide-up-leave-to {
            opacity: 0;
            transform: translateY(-20px);
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
    </style>
</head>

<body class="bg-[url(asset/gambar/wanita.png)] bg-size-[auto_-50px] bg-left bg-no-repeat">

    <div id="app" class=" flex w-full h-full" v-cloak>

        <!-- Sidebar -->
        <aside
            class="w-64 bg-white/90 backdrop-blur-sm border-r border-slate-200 flex flex-col z-20 transition-all duration-300"
            :class="{'hidden': isMobile && !isSidebarOpen, 'fixed inset-y-0 left-0': isMobile}">

            <!-- Logo Area -->
            <div class="h-16 flex items-center px-6 border-b border-slate-100">
                <div class="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center mr-3 text-white font-bold">
                    <i class="fas fa-graduation-cap"></i>
                </div>
                <div>
                    <h1 class="font-bold text-slate-800 leading-tight">SMKMYCKB</h1>
                    <p class="text-[10px] text-slate-400 font-medium tracking-wider uppercase">Teacher Panel</p>
                </div>
            </div>

            <!-- User Profile Snippet -->
            <div class="p-6 text-center border-b border-slate-50">
                <div class="relative w-20 h-20 mx-auto mb-3 cursor-pointer group" @click="openProfileModal">
                    <img :src="teacherData.photoBase64 || `https://api.dicebear.com/7.x/avataaars/svg?seed=${teacherData.avatar_seed || 'Teacher'}`"
                        class="w-full h-full rounded-full object-cover border-4 border-slate-50 shadow-sm group-hover:border-blue-100 transition-all">
                    <div
                        class="absolute bottom-0 right-0 bg-white/90 backdrop-blur-sm rounded-full p-1.5 shadow-sm border border-slate-100 text-slate-400 group-hover:text-blue-500">
                        <i class="fas fa-pen text-xs"></i>
                    </div>
                </div>
                <h3 class="font-bold text-slate-800 text-sm">{{ teacherData.name || 'Loading...' }}</h3>
                <p class="text-xs text-slate-500 mb-2">{{ teacherData.role_detail || 'Guru Mapel' }}</p>
                <div
                    class="inline-flex items-center px-2 py-0.5 rounded text-[10px] font-bold bg-blue-50 text-blue-600 border border-blue-100">
                    LVL {{ teacherData.level || 1 }}
                </div>
            </div>

            <!-- Navigation -->
            <nav class="flex-1 overflow-y-auto py-4 px-3 space-y-1">
                <!-- Standard Nav Items -->
                <a v-for="item in navItems" :key="item.id"
                    @click="currentTab = item.id; isMobile ? isSidebarOpen = false : null"
                    class="flex items-center px-3 py-2.5 rounded-lg text-sm font-medium transition-all cursor-pointer group"
                    :class="currentTab === item.id ? 'bg-blue-50 text-blue-600' : 'text-slate-500 hover:bg-slate-50 hover:text-slate-700'">
                    <i :class="item.icon + ' w-5 text-center mr-3 transition-colors'"
                        :class="currentTab === item.id ? 'text-blue-500' : 'text-slate-400 group-hover:text-slate-500'"></i>
                    {{ item.label }}
                </a>

                <!-- Dreamy / D&D Submenu -->
                <div class="pt-2">
                    <button @click="isDreamyOpen = !isDreamyOpen"
                        class="w-full flex items-center justify-between px-3 py-2.5 rounded-lg text-sm font-medium transition-all cursor-pointer group"
                        :class="['dreamy','inventory','shop','grimoire'].includes(currentTab) ? 'bg-purple-50 text-purple-600' : 'text-slate-500 hover:bg-slate-50 hover:text-slate-700'">
                        <div class="flex items-center">
                            <i class="fas fa-hat-wizard w-5 text-center mr-3 transition-colors"
                                :class="['dreamy','inventory','shop','grimoire'].includes(currentTab) ? 'text-purple-500' : 'text-slate-400 group-hover:text-slate-500'"></i>
                            <span>Dreamy / D&amp;D</span>
                        </div>
                        <i class="fas text-xs transition-transform duration-200"
                            :class="isDreamyOpen ? 'fa-chevron-up' : 'fa-chevron-down'"></i>
                    </button>
                    <!-- Submenu Items -->
                    <div v-show="isDreamyOpen" class="ml-4 mt-1 space-y-1 border-l-2 border-purple-100 pl-2">
                        <a @click="currentTab = 'inventory'; isMobile ? isSidebarOpen = false : null"
                            class="flex items-center px-3 py-2 rounded-lg text-sm font-medium transition-all cursor-pointer group"
                            :class="currentTab === 'inventory' ? 'bg-purple-50 text-purple-600' : 'text-slate-500 hover:bg-slate-50 hover:text-slate-700'">
                            <i class="fas fa-briefcase w-5 text-center mr-2 text-xs"
                                :class="currentTab === 'inventory' ? 'text-purple-500' : 'text-slate-400'"></i>
                            Tas &amp; Skill
                        </a>
                        <a @click="currentTab = 'shop'; isMobile ? isSidebarOpen = false : null"
                            class="flex items-center px-3 py-2 rounded-lg text-sm font-medium transition-all cursor-pointer group"
                            :class="currentTab === 'shop' ? 'bg-purple-50 text-purple-600' : 'text-slate-500 hover:bg-slate-50 hover:text-slate-700'">
                            <i class="fas fa-shopping-cart w-5 text-center mr-2 text-xs"
                                :class="currentTab === 'shop' ? 'text-purple-500' : 'text-slate-400'"></i>
                            Toko Item
                        </a>
                        <a @click="currentTab = 'grimoire'; isMobile ? isSidebarOpen = false : null"
                            class="flex items-center px-3 py-2 rounded-lg text-sm font-medium transition-all cursor-pointer group"
                            :class="currentTab === 'grimoire' ? 'bg-purple-50 text-purple-600' : 'text-slate-500 hover:bg-slate-50 hover:text-slate-700'">
                            <i class="fas fa-wand-magic-sparkles w-5 text-center mr-2 text-xs"
                                :class="currentTab === 'grimoire' ? 'text-purple-500' : 'text-slate-400'"></i>
                            Grimoire
                        </a>
                    </div>
                </div>
            </nav>

            <!-- Logout -->
            <div class="mt-auto p-4 border-t border-slate-100">
                <button @click="logout"
                    class="w-full py-2.5 px-4 bg-red-50 text-red-600 rounded-lg text-sm font-bold flex items-center justify-center hover:bg-red-100 transition-colors shadow-sm active:scale-95 group">
                    <i class="fas fa-sign-out-alt mr-2 group-hover:-translate-x-1 transition-transform"></i>
                    Sign Out
                </button>
            </div>
        </aside>

        <!-- Overlay for Mobile -->
        <div v-if="isMobile && isSidebarOpen" @click="isSidebarOpen = false"
            class="fixed inset-0 bg-slate-900/20 z-10 backdrop-blur-sm"></div>

        <!-- Main Content -->
        <main class="flex-1 flex flex-col h-screen overflow-hidden bg-slate-50/50 relative">

            <!-- Desktop Header -->
            <header
                class="h-16 bg-white/90 backdrop-blur-sm/80 backdrop-blur-md border-b border-slate-200 hidden md:flex items-center justify-between px-8 sticky top-0 z-10">
                <div class="flex items-center gap-4">
                    <h2 class="text-xl font-bold text-slate-800 tracking-tight">DREAMY <span
                            class="text-blue-600">Teacher</span></h2>
                </div>
                <div class="flex items-center gap-4">
                    <!-- Teacher Chat Button -->
                    <div class="relative">
                        <button @click="toggleTeacherChat"
                            class="p-2 rounded-full hover:bg-slate-100 transition-colors relative" title="Pigeon Post">
                            <i class="fas fa-dove text-slate-400 hover:text-blue-500 transition-colors text-xl"></i>
                            <span v-if="totalUnreadChats > 0"
                                class="absolute top-1 right-1 flex items-center justify-center h-4 w-4 rounded-full bg-red-500 ring-1 ring-white text-[9px] text-white font-bold">{{
                                totalUnreadChats }}</span>
                        </button>
                    </div>

                    <!-- Notification Bell -->
                    <div class="relative group">
                        <button class="p-2 rounded-full hover:bg-slate-100 relative transition-colors">
                            <lord-icon src="https://cdn.lordicon.com/ahxaipjb.json" trigger="hover"
                                colors="primary:#64748b" style="width:24px;height:24px">
                            </lord-icon>
                            <!-- Badge (Hidden for now, can be dynamic later) -->
                            <span
                                class="absolute top-2 right-2 w-2 h-2 bg-red-500 rounded-full border border-white hidden"></span>
                        </button>
                        <!-- Dropdown (Simple/Placeholder) -->
                        <div
                            class="absolute right-0 mt-2 w-80 bg-white/90 backdrop-blur-sm rounded-xl shadow-lg border border-slate-100 p-4 hidden group-hover:block transition-all transform origin-top-right">
                            <h4 class="font-bold text-slate-800 mb-3 text-sm">Notifikasi</h4>
                            <div class="text-center py-8 text-slate-400 text-xs">
                                <i class="fas fa-bell-slash text-2xl mb-2 opacity-50"></i>
                                <p>Belum ada notifikasi baru.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Mobile Header -->
            <header
                class="h-16 bg-white/90 backdrop-blur-sm border-b border-slate-200 flex items-center justify-between px-4 md:hidden flex-shrink-0">
                <div class="font-bold text-slate-800">SMKMYCKB</div>
                <button @click="isSidebarOpen = true" class="text-slate-500 p-2">
                    <i class="fas fa-bars"></i>
                </button>
            </header>

            <!-- Content Scroll Area -->
            <div class="flex-1 overflow-y-auto p-4 md:p-8" id="main-scroll">
                <div class="max-w-7xl mx-auto flex flex-col min-h-full">

                    <!-- Dynamic View Component -->
                    <transition name="slide-up" mode="out-in">

                        <!-- DASHBOARD VIEW -->
                        <div v-if="currentTab === 'dashboard'" key="dashboard" class="space-y-6">
                            <!-- Header & Greetings -->
                            <div
                                class="bg-white/90 backdrop-blur-sm p-6 rounded-2xl shadow-sm border border-slate-100 flex justify-between items-center">
                                <div>
                                    <h2 class="text-2xl font-bold text-slate-800">Wilujeng Enjing, <span
                                            class="text-blue-600">{{ firstName }}</span>! üëã</h2>
                                    <p class=" text-orange-500 bg-clip-text text-sm mt-1">Siap
                                        mencerdaskan
                                        kehidupan bangsa hari ini?
                                    </p>
                                </div>
                                <div class="text-right hidden md:block">
                                    <p class="text-xs font-bold text-slate-400 uppercase tracking-wider">{{ currentDate
                                        }}</p>
                                </div>
                            </div>

                            <!-- HUD Stats -->
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                                <stat-card label="Health" icon="heart" color="red" :value="teacherData.hp"
                                    :max="teacherData.max_hp" unit="%"></stat-card>
                                <stat-card label="Mana" icon="bolt" color="blue" :value="teacherData.mp"
                                    :max="teacherData.max_mp" unit="%"></stat-card>
                                <stat-card label="Experience" icon="star" color="yellow" :value="teacherData.xp"
                                    :max="teacherData.max_xp" unit="XP"></stat-card>
                                <div
                                    class="bg-white/90 backdrop-blur-sm p-4 rounded-xl shadow-sm border border-slate-100 flex items-center justify-between">
                                    <div>
                                        <p class="text-[10px] uppercase font-bold text-slate-400 tracking-wider">Wealth
                                        </p>
                                        <div class="text-lg font-bold text-slate-800 mt-1">{{ teacherData.coin }} <span
                                                class="text-xs font-normal text-amber-500">Gold</span></div>
                                    </div>
                                    <div
                                        class="w-10 h-10 rounded-full bg-amber-50 text-amber-500 flex items-center justify-center">
                                        <i class="fas fa-coins"></i>
                                    </div>
                                </div>
                            </div>

                            <!-- Activity Cards -->
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                                <!-- Placeholders for now -->
                                <div class="bg-white/90 backdrop-blur-sm p-5 rounded-xl border border-slate-100 shadow-sm flex items-center justify-between"
                                    v-for="stat in quickStats" :key="stat.label">
                                    <div>
                                        <p class="text-xs text-slate-500 mb-1">{{ stat.label }}</p>
                                        <h3 class="text-xl font-bold text-slate-800">{{ stat.value }}</h3>
                                    </div>
                                    <div :class="`p-3 rounded-full bg-${stat.color}-50 text-${stat.color}-500`">
                                        <i :class="stat.icon"></i>
                                    </div>
                                </div>
                            </div>


                        </div>

                        <!-- GRIMOIRE VIEW -->
                        <div v-if="currentTab === 'grimoire'" key="grimoire" class="space-y-6">
                            <div class="flex items-center gap-3 mb-2">
                                <div class="w-10 h-10 rounded-xl bg-purple-100 flex items-center justify-center">
                                    <i class="fas fa-wand-magic-sparkles text-purple-600 text-lg"></i>
                                </div>
                                <div
                                    class="bg-white/90 backdrop-blur-sm p-6 rounded-2xl shadow-sm border border-slate-100 flex justify-between items-center">
                                    <div>
                                        <h2 class="text-2xl font-bold text-slate-800">Grimoire</h2>
                                        <p class="text-xs text-slate-500">Mantra dan sihir yang kamu kuasai</p>
                                    </div>
                                </div>
                            </div>

                            <div
                                class="bg-white/90 backdrop-blur-sm p-6 rounded-2xl shadow-sm border border-purple-100">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <spell-card name="Silence Detection" desc="Cost: 20 MP ‚Ä¢ Lvl 5" color="purple"
                                        :locked="teacherData.level < 5" @cast="castSpell('noise')">
                                    </spell-card>
                                </div>
                            </div>
                        </div>

                        <!-- THE DAILY GRIND VIEW -->
                        <div v-if="currentTab === 'grind'" key="grind" class="space-y-6">
                            <div class="bg-white/90 backdrop-blur-sm p-6 rounded-2xl shadow-sm border border-slate-200">
                                <h2 class="text-2xl font-bold text-slate-800 mb-6">Jurnal Refleksi Guru</h2>


                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                    <div>
                                        <label class="block text-xs font-bold text-slate-500 mb-1">Tanggal</label>
                                        <input v-model="journalForm.date" type="date"
                                            class="w-full px-3 py-2 border border-slate-200 rounded-lg text-sm bg-slate-50">
                                    </div>
                                    <div>
                                        <label class="block text-xs font-bold text-slate-500 mb-1">Hari</label>
                                        <input v-model="journalForm.day" type="text" readonly
                                            class="w-full px-3 py-2 border border-slate-200 rounded-lg text-sm bg-slate-100 text-slate-500 cursor-not-allowed">
                                    </div>
                                    <div>
                                        <label class="block text-xs font-bold text-slate-500 mb-1">Kelas</label>
                                        <select v-model="journalForm.class"
                                            class="w-full px-3 py-2 border border-slate-200 rounded-lg text-sm bg-slate-50">
                                            <option disabled value="">Pilih Kelas</option>
                                            <option v-for="cls in classList" :key="cls" :value="cls">{{ cls }}</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-xs font-bold text-slate-500 mb-1">Mata
                                            Pelajaran</label>
                                        <input v-model="journalForm.subject" placeholder="Contoh: Matematika"
                                            type="text"
                                            class="w-full px-3 py-2 border border-slate-200 rounded-lg text-sm bg-slate-50">
                                    </div>
                                </div>

                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-4">
                                    <div class="p-4 bg-slate-50 rounded-xl border border-slate-100">
                                        <label class="block text-xs font-bold text-slate-500 mb-2">Cuaca Hati
                                            (Mood)</label>
                                        <div class="flex gap-4">
                                            <label class="cursor-pointer">
                                                <input type="radio" v-model="journalForm.feeling" value="Senang"
                                                    class="hidden peer">
                                                <div
                                                    class="px-3 py-2 bg-white/90 backdrop-blur-sm border border-slate-200 rounded-lg peer-checked:bg-green-100 peer-checked:border-green-400 peer-checked:text-green-700 flex items-center gap-2 hover:bg-slate-50">
                                                    <i class="fas fa-smile text-yellow-500"></i> <span
                                                        class="text-sm">Senang</span>
                                                </div>
                                            </label>
                                            <label class="cursor-pointer">
                                                <input type="radio" v-model="journalForm.feeling" value="Biasa"
                                                    class="hidden peer">
                                                <div
                                                    class="px-3 py-2 bg-white/90 backdrop-blur-sm border border-slate-200 rounded-lg peer-checked:bg-blue-100 peer-checked:border-blue-400 peer-checked:text-blue-700 flex items-center gap-2 hover:bg-slate-50">
                                                    <i class="fas fa-meh text-blue-500"></i> <span
                                                        class="text-sm">Biasa</span>
                                                </div>
                                            </label>
                                            <label class="cursor-pointer">
                                                <input type="radio" v-model="journalForm.feeling" value="Sedih"
                                                    class="hidden peer">
                                                <div
                                                    class="px-3 py-2 bg-white/90 backdrop-blur-sm border border-slate-200 rounded-lg peer-checked:bg-red-100 peer-checked:border-red-400 peer-checked:text-red-700 flex items-center gap-2 hover:bg-slate-50">
                                                    <i class="fas fa-frown text-red-500"></i> <span
                                                        class="text-sm">Sedih</span>
                                                </div>
                                            </label>
                                        </div>
                                    </div>
                                    <div class="p-4 bg-slate-50 rounded-xl border border-slate-100">
                                        <label class="block text-xs font-bold text-slate-500 mb-2">Cuaca
                                            (Weather)</label>
                                        <div class="flex gap-4">
                                            <label class="cursor-pointer">
                                                <input type="radio" v-model="journalForm.weather" value="Cerah"
                                                    class="hidden peer">
                                                <div
                                                    class="px-3 py-2 bg-white/90 backdrop-blur-sm border border-slate-200 rounded-lg peer-checked:bg-yellow-100 peer-checked:border-yellow-400 peer-checked:text-yellow-700 flex items-center gap-2 hover:bg-slate-50">
                                                    <i class="fas fa-sun text-orange-500"></i> <span
                                                        class="text-sm">Cerah</span>
                                                </div>
                                            </label>
                                            <label class="cursor-pointer">
                                                <input type="radio" v-model="journalForm.weather" value="Hujan"
                                                    class="hidden peer">
                                                <div
                                                    class="px-3 py-2 bg-white/90 backdrop-blur-sm border border-slate-200 rounded-lg peer-checked:bg-slate-200 peer-checked:border-slate-400 peer-checked:text-slate-700 flex items-center gap-2 hover:bg-slate-50">
                                                    <i class="fas fa-cloud-showers-heavy text-slate-500"></i> <span
                                                        class="text-sm">Hujan</span>
                                                </div>
                                            </label>
                                        </div>
                                    </div>
                                </div>

                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-xs font-bold text-slate-500 mb-1">Uraian Tugas /
                                            Kegiatan</label>
                                        <textarea v-model="journalForm.tasks" rows="3"
                                            class="w-full px-3 py-2 border border-slate-200 rounded-lg text-sm bg-slate-50 focus:ring-blue-500"
                                            placeholder="Apa yang diajarkan hari ini?"></textarea>
                                    </div>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-xs font-bold text-slate-500 mb-1">Pencapaian Siswa
                                                / Kejadian Penting</label>
                                            <textarea v-model="journalForm.achievements" rows="2"
                                                class="w-full px-3 py-2 border border-slate-200 rounded-lg text-sm bg-slate-50 focus:ring-blue-500"></textarea>
                                        </div>
                                        <div>
                                            <label class="block text-xs font-bold text-slate-500 mb-1">Catatan Khusus /
                                                Kendala</label>
                                            <textarea v-model="journalForm.notes" rows="2"
                                                class="w-full px-3 py-2 border border-slate-200 rounded-lg text-sm bg-slate-50 focus:ring-blue-500"></textarea>
                                        </div>
                                    </div>
                                    <div>
                                        <label class="block text-xs font-bold text-slate-500 mb-1">Rencana Tindak Lanjut
                                            (Besok)</label>
                                        <input v-model="journalForm.tomorrowPlan" type="text"
                                            class="w-full px-3 py-2 border border-slate-200 rounded-lg text-sm bg-slate-50 focus:ring-blue-500">
                                    </div>
                                </div>

                                <div class="mt-6 flex justify-end">
                                    <button @click="submitJournal"
                                        class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-xl shadow-lg shadow-blue-500/30 transition transform hover:-translate-y-1 active:translate-y-0">
                                        <i class="fas fa-paper-plane mr-2"></i> Simpan Jurnal & Dapat XP
                                    </button>
                                </div>
                            </div>

                            <!-- Journal History List -->
                            <div class="bg-white/90 backdrop-blur-sm p-6 rounded-2xl shadow-sm border border-slate-200">
                                <h3 class="font-bold text-lg text-slate-800 mb-4">Riwayat Jurnal</h3>

                                <!-- Filters -->
                                <div class="flex flex-wrap gap-4 mb-6 relative z-10">
                                    <div class="flex-1 min-w-[150px]">
                                        <label class="block text-xs font-bold text-slate-500 mb-1">Cari</label>
                                        <input v-model="journalFilter.search" type="text"
                                            placeholder="Mapel, kegiatan..."
                                            class="w-full px-3 py-2 border border-slate-200 rounded-lg text-sm focus:ring-blue-500">
                                    </div>
                                    <div>
                                        <label class="block text-xs font-bold text-slate-500 mb-1">Dari Tanggal</label>
                                        <input v-model="journalFilter.startDate" type="date"
                                            class="px-3 py-2 border border-slate-200 rounded-lg text-sm focus:ring-blue-500">
                                    </div>
                                    <div>
                                        <label class="block text-xs font-bold text-slate-500 mb-1">Sampai
                                            Tanggal</label>
                                        <input v-model="journalFilter.endDate" type="date"
                                            class="px-3 py-2 border border-slate-200 rounded-lg text-sm focus:ring-blue-500">
                                    </div>
                                    <div class="flex items-end">
                                        <button @click="printJournals"
                                            class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg text-sm transition shadow-sm h-[38px] flex items-center"
                                            title="Cetak Laporan">
                                            <i class="fas fa-print mr-2"></i> Cetak
                                        </button>
                                    </div>
                                </div>

                                <!-- Empty State -->
                                <div v-if="filteredJournals.length === 0" class="text-center py-10 text-slate-400">
                                    <i class="fas fa-book-open text-4xl mb-3 opacity-30"></i>
                                    <p>Belum ada jurnal yang ditemukan.</p>
                                </div>

                                <!-- Journal Cards -->
                                <div class="space-y-4">
                                    <div v-for="j in filteredJournals" :key="j.id"
                                        class="p-4 border border-l-4 border-slate-100 rounded-lg hover:shadow-md transition bg-slate-50 border-l-blue-500 relative group">

                                        <!-- Delete Button -->
                                        <button @click="deleteJournal(j.id)"
                                            class="absolute top-3 right-3 text-slate-300 hover:text-red-500 transition opacity-0 group-hover:opacity-100"
                                            title="Hapus Jurnal">
                                            <i class="fas fa-trash"></i>
                                        </button>

                                        <div class="flex items-center gap-3 mb-2">
                                            <span
                                                class="px-2 py-1 bg-blue-100 text-blue-700 text-xs font-bold rounded">{{
                                                j.class }}</span>
                                            <span class="font-bold text-slate-700">{{ j.subject }}</span>
                                            <span class="text-xs text-slate-400">‚Ä¢ {{ j.date }} ({{ j.day }})</span>
                                            <div class="flex gap-2 ml-auto mr-8">
                                                <span v-if="j.feeling"
                                                    class="text-xs px-2 py-0.5 rounded bg-white/90 backdrop-blur-sm border border-slate-200"
                                                    :title="j.feeling">
                                                    <i v-if="j.feeling === 'Senang'"
                                                        class="fas fa-smile text-green-500"></i>
                                                    <i v-else-if="j.feeling === 'Biasa'"
                                                        class="fas fa-meh text-blue-500"></i>
                                                    <i v-else-if="j.feeling === 'Sedih'"
                                                        class="fas fa-frown text-red-500"></i>
                                                    {{ j.feeling }}
                                                </span>
                                                <span v-if="j.weather"
                                                    class="text-xs px-2 py-0.5 rounded bg-white/90 backdrop-blur-sm border border-slate-200"
                                                    :title="j.weather">
                                                    <i v-if="j.weather === 'Cerah'"
                                                        class="fas fa-sun text-orange-500"></i>
                                                    <i v-else-if="j.weather === 'Hujan'"
                                                        class="fas fa-cloud-showers-heavy text-slate-500"></i>
                                                    {{ j.weather }}
                                                </span>
                                            </div>
                                        </div>

                                        <div class="text-sm text-slate-600 mb-2 whitespace-pre-line">{{ j.tasks }}</div>

                                        <div v-if="j.achievements || j.notes"
                                            class="grid grid-cols-1 md:grid-cols-2 gap-2 text-xs mt-3 pt-3 border-t border-slate-200">
                                            <div v-if="j.achievements">
                                                <strong class="text-green-600">Pencapaian:</strong> {{ j.achievements }}
                                            </div>
                                            <div v-if="j.notes">
                                                <strong class="text-orange-500">Catatan/Kendala:</strong> {{ j.notes }}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ATTENDANCE VIEW -->
                        <div v-if="currentTab === 'absensi'" key="absensi" class="space-y-6">
                            <div
                                class="flex flex-col md:flex-row justify-between items-center gap-4 bg-white/90 backdrop-blur-sm p-4 rounded-xl shadow-sm border border-slate-100">
                                <div>
                                    <h2 class="text-xl font-bold text-slate-800">Absensi Siswa</h2>
                                    <p class="text-xs text-slate-500">Catat kehadiran dan berikan reward/punishment.</p>
                                </div>
                                <div class="flex gap-2 w-full md:w-auto">
                                    <select v-model="selectedClass" @change="fetchStudents"
                                        class="px-3 py-2 border border-slate-200 rounded-lg text-sm focus:ring-blue-500 outline-none">
                                        <option value="">Pilih Kelas...</option>
                                        <option v-for="cls in classList" :key="cls" :value="cls">{{ cls }}</option>
                                    </select>
                                    <input type="date" v-model="selectedDate"
                                        class="px-3 py-2 border border-slate-200 rounded-lg text-sm outline-none">
                                </div>
                            </div>

                            <!-- Attendance Table -->
                            <div
                                class="bg-white/90 backdrop-blur-sm rounded-xl shadow-sm border border-slate-100 overflow-hidden">
                                <div v-if="loadingStudents" class="p-8 text-center text-slate-500">Loading data...</div>
                                <div v-else-if="students.length === 0" class="p-8 text-center text-slate-400 italic">
                                    Pilih kelas untuk memuat data.</div>
                                <table v-else class="w-full text-left text-sm">
                                    <thead
                                        class="bg-slate-50 border-b border-slate-100 text-slate-500 Uppercase text-xs">
                                        <tr>
                                            <th class="px-4 py-3 font-semibold w-12">No</th>
                                            <th class="px-4 py-3 font-semibold">Nama Siswa</th>
                                            <th class="px-4 py-3 font-semibold text-center">Status</th>
                                            <th class="px-4 py-3 font-semibold">Note</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-slate-50">
                                        <tr v-for="(student, idx) in students" :key="student.uid"
                                            class="hover:bg-slate-50 transition">
                                            <td class="px-4 py-3 text-slate-400">{{ idx + 1 }}</td>
                                            <td class="px-4 py-3 font-medium text-slate-700">{{ student.name }}</td>
                                            <td class="px-4 py-3 text-center">
                                                <div class="inline-flex bg-slate-100 rounded-lg p-1">
                                                    <button v-for="status in ['H', 'S', 'I', 'A']" :key="status"
                                                        @click="updateStatus(student.uid, status)"
                                                        :class="{'bg-white/90 backdrop-blur-sm shadow-sm font-bold': attendanceUpdates[student.uid]?.status === status,
                                                                      'text-green-600': attendanceUpdates[student.uid]?.status === 'H' && status === 'H',
                                                                      'text-red-500': attendanceUpdates[student.uid]?.status === 'A' && status === 'A',
                                                                      'text-slate-400': attendanceUpdates[student.uid]?.status !== status}"
                                                        class="w-8 h-8 rounded-md text-xs transition-all">
                                                        {{ status }}
                                                    </button>
                                                </div>
                                            </td>
                                            <td class="px-4 py-3">
                                                <div v-if="attendanceUpdates[student.uid]?.status === 'H'"
                                                    class="text-xs text-green-600 font-medium">‚ú® Rajin (+XP)</div>
                                                <div v-else-if="attendanceUpdates[student.uid]?.status === 'A'"
                                                    class="text-xs text-red-500 font-medium">‚ö†Ô∏è Bolos (-HP)</div>
                                                <input v-else type="text" v-model="attendanceUpdates[student.uid].note"
                                                    class="w-full text-xs border-b border-slate-200 focus:border-blue-500 outline-none bg-transparent py-1"
                                                    placeholder="Keterangan...">
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <div class="flex justify-end" v-if="students.length > 0">
                                <button @click="saveAttendance"
                                    class="bg-blue-600 text-white px-6 py-3 rounded-xl font-bold hover:bg-blue-700 shadow-lg shadow-blue-500/20 transition-all active:scale-95">
                                    Simpan Absensi
                                </button>
                            </div>
                        </div>

                        <!-- INVENTORY & SKILLS VIEW -->
                        <div v-if="currentTab === 'inventory'" key="inventory" class="space-y-6">

                            <!-- Header -->
                            <div
                                class="bg-white/90 backdrop-blur-sm p-6 rounded-2xl shadow-sm border border-slate-100 flex justify-between items-center">
                                <div>
                                    <h2 class="text-xl font-bold text-slate-800">Tas & Skill Guru</h2>
                                    <p class="text-xs text-slate-500">Kelola item, efek aktif, dan gunakan skill mu.</p>
                                </div>
                                <div
                                    class="bg-blue-50 px-4 py-2 rounded-lg border border-blue-100 flex items-center gap-3">
                                    <i class="fas fa-gem text-blue-500"></i>
                                    <div>
                                        <div class="text-xs text-slate-400 font-bold">Level Kamu</div>
                                        <div class="text-lg font-bold text-blue-700">{{ teacherData.level || 1 }}</div>
                                    </div>
                                </div>
                            </div>

                            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                                <!-- Active Effects (Left Col) -->
                                <div class="lg:col-span-1 space-y-6">
                                    <div
                                        class="bg-white/90 backdrop-blur-sm p-6 rounded-2xl shadow-sm border border-slate-100 h-full">
                                        <h3 class="font-bold text-md text-slate-800 mb-4 flex items-center gap-2">
                                            <i class="fas fa-magic text-purple-500"></i> Status Efek Aktif
                                        </h3>
                                        <div v-if="activeEffects.length === 0"
                                            class="text-center py-8 text-slate-400 text-sm bg-slate-50 rounded-lg border border-dashed border-slate-200">
                                            Tidak ada efek/buff aktif.
                                        </div>
                                        <div v-else class="space-y-3">
                                            <div v-for="(effect, index) in activeEffects" :key="index"
                                                class="p-3 bg-purple-50 border border-purple-100 rounded-lg flex items-center gap-3">
                                                <div class="bg-white/90 backdrop-blur-sm p-2 rounded-full shadow-sm">
                                                    <img :src="effect.icon || 'https://via.placeholder.com/32'"
                                                        class="w-8 h-8 object-contain">
                                                </div>
                                                <div>
                                                    <div class="font-bold text-sm text-slate-700">{{ effect.name }}
                                                    </div>
                                                    <div class="text-xs text-slate-500">{{ effect.description }}</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Skills & Inventory (Right Col) -->
                                <div class="lg:col-span-2 space-y-6">

                                    <!-- Skills Section -->
                                    <div
                                        class="bg-white/90 backdrop-blur-sm p-6 rounded-2xl shadow-sm border border-slate-100">
                                        <h3 class="font-bold text-md text-slate-800 mb-4 flex items-center gap-2">
                                            <i class="fas fa-meteor text-orange-500"></i> Skill Guru
                                        </h3>
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            <div v-for="skill in skills" :key="skill.id"
                                                class="relative overflow-hidden p-4 rounded-xl border transition-all"
                                                :class="skill.locked ? 'bg-slate-50 border-slate-200' : 'bg-white/90 backdrop-blur-sm border-slate-200 hover:border-blue-300 hover:shadow-md'">

                                                <div class="flex justify-between items-start z-10 relative">
                                                    <div class="flex items-center gap-3">
                                                        <div class="p-2 rounded-lg"
                                                            :class="skill.locked ? 'bg-slate-200 text-slate-400' : `bg-${skill.color}-100 text-${skill.color}-600`">
                                                            <i :class="`fas fa-${skill.icon}`"></i>
                                                        </div>
                                                        <div>
                                                            <h4 class="font-bold text-slate-800 text-sm">{{ skill.name
                                                                }}</h4>
                                                            <div class="text-[10px] font-bold px-1.5 py-0.5 rounded inline-block mt-1"
                                                                :class="skill.locked ? 'bg-slate-200 text-slate-500' : 'bg-slate-100 text-slate-600'">
                                                                LVL {{ skill.minLevel }}
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <button @click="openSkillModal(skill)" :disabled="skill.locked"
                                                        class="px-3 py-1.5 rounded-lg text-xs font-bold transition-all"
                                                        :class="skill.locked ? 'bg-slate-200 text-slate-400 cursor-not-allowed' : `bg-${skill.color}-600 text-white hover:bg-${skill.color}-700 shadow-lg shadow-${skill.color}-500/30`">
                                                        {{ skill.locked ? 'Terkunci' : 'Gunakan' }}
                                                    </button>
                                                </div>
                                                <p class="text-xs text-slate-500 mt-3 relative z-10">{{ skill.desc }}
                                                </p>

                                                <!-- Locked Overlay -->
                                                <div v-if="skill.locked" class="absolute inset-0 bg-slate-100/50 z-0">
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Inventory Section -->
                                    <div
                                        class="bg-white/90 backdrop-blur-sm p-6 rounded-2xl shadow-sm border border-slate-100">
                                        <h3 class="font-bold text-md text-slate-800 mb-4 flex items-center gap-2">
                                            <i class="fas fa-briefcase text-amber-600"></i> Tas Baramg
                                        </h3>
                                        <div class="grid grid-cols-4 sm:grid-cols-5 gap-3">
                                            <div v-for="(item, idx) in inventory" :key="idx"
                                                class="aspect-square bg-slate-50 rounded-lg border border-slate-200 flex flex-col items-center justify-center p-2 hover:border-blue-300 transition cursor-pointer relative group">
                                                <img :src="item.icon || 'https://via.placeholder.com/48'"
                                                    class="w-8 h-8 object-contain mb-1">
                                                <span
                                                    class="text-[10px] text-center leading-tight line-clamp-2 text-slate-600 font-medium">{{
                                                    item.name }}</span>
                                                <span
                                                    class="absolute top-1 right-1 bg-slate-800 text-white text-[9px] px-1 rounded-full">{{
                                                    item.quantity || 1 }}</span>

                                                <!-- Tooltip -->
                                                <div
                                                    class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-32 bg-slate-800 text-white text-xs rounded p-2 hidden group-hover:block z-20">
                                                    <div class="font-bold">{{ item.name }}</div>
                                                    <div class="text-[10px] text-slate-300">{{ item.description }}</div>
                                                </div>
                                            </div>
                                            <!-- Empty Slots Filler (Visual Only) -->
                                            <div v-for="n in Math.max(0, 10 - inventory.length)" :key="'empty'+n"
                                                class="aspect-square bg-slate-50/50 rounded-lg border border-dashed border-slate-200">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- SHOP VIEW -->
                        <div v-if="currentTab === 'shop'" key="shop" class="space-y-6">
                            <!-- Shop Header -->
                            <div
                                class="bg-white/90 backdrop-blur-sm p-6 rounded-2xl shadow-sm border border-slate-100 flex justify-between items-center">
                                <div>
                                    <h2 class="text-xl font-bold text-slate-800">Toko Item</h2>
                                    <p class="text-xs text-slate-500">Beli item untuk membantu siswa atau diri sendiri.
                                    </p>
                                </div>
                                <div
                                    class="bg-amber-50 px-4 py-2 rounded-lg border border-amber-100 flex items-center gap-3">
                                    <i class="fas fa-coins text-amber-500"></i>
                                    <div>
                                        <div class="text-xs text-slate-400 font-bold">Koin Kamu</div>
                                        <div class="text-lg font-bold text-amber-600">{{ teacherData.coin || 0 }}</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Shop Grid -->
                            <div
                                class="bg-white/90 backdrop-blur-sm p-6 rounded-2xl shadow-sm border border-slate-100 h-full">
                                <div v-if="shopItems.length === 0"
                                    class="flex flex-col items-center justify-center py-10 text-center">
                                    <i class="fas fa-store-slash text-4xl text-slate-300 mb-2"></i>
                                    <p class="text-slate-500">Toko sedang tutup atau belum ada barang.</p>
                                </div>

                                <div v-else class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                    <div v-for="item in shopItems" :key="item.id"
                                        class="bg-white/90 backdrop-blur-sm rounded-xl shadow-sm border border-slate-100 overflow-hidden hover:shadow-md transition-all flex flex-col group relative">

                                        <!-- Item Image -->
                                        <div class="h-40 bg-slate-50 relative overflow-hidden">
                                            <img :src="item.imageBase64 || item.icon || 'https://via.placeholder.com/300x200?text=Item'"
                                                class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500">
                                            <div v-if="(item.stock || 0) <= 0"
                                                class="absolute inset-0 bg-slate-900/60 flex items-center justify-center backdrop-blur-[1px]">
                                                <span
                                                    class="text-white font-bold text-lg border-2 border-white px-3 py-1 -rotate-6 rounded">STOK
                                                    HABIS</span>
                                            </div>
                                            <div
                                                class="absolute top-2 right-2 bg-white/90 backdrop-blur-sm/90 backdrop-blur-sm text-xs px-2 py-1 rounded shadow-sm text-slate-500 font-medium">
                                                Stok: {{ item.stock || 0 }}
                                            </div>
                                        </div>

                                        <!-- Item Content -->
                                        <div class="p-4 flex-1 flex flex-col">
                                            <div class="flex justify-between items-start mb-2">
                                                <h3 class="font-bold text-slate-800 text-sm line-clamp-1">{{ item.name
                                                    }}</h3>
                                                <div
                                                    class="flex items-center gap-1 text-amber-600 font-bold text-sm bg-amber-50 px-2 py-0.5 rounded-md">
                                                    <i class="fas fa-coins text-xs"></i>
                                                    {{ item.price }}
                                                </div>
                                            </div>

                                            <p class="text-xs text-slate-400 mb-4 line-clamp-2 h-8 leading-tight">{{
                                                item.description }}</p>

                                            <!-- Buy Button -->
                                            <button @click="buyItem(item)"
                                                :disabled="(item.stock || 0) <= 0 || (teacherData.coin || 0) < item.price"
                                                class="mt-auto w-full py-2.5 rounded-lg font-bold text-xs transition-all flex items-center justify-center gap-2"
                                                :class="(item.stock || 0) > 0 && (teacherData.coin || 0) >= item.price 
                                                    ? 'bg-blue-600 text-white hover:bg-blue-700 active:scale-95 shadow-lg shadow-blue-500/20' 
                                                    : 'bg-slate-100 text-slate-400 cursor-not-allowed'">
                                                <i class="fas fa-shopping-cart text-[10px]"></i>
                                                {{ (item.stock || 0) <= 0 ? 'Habis' : ((teacherData.coin || 0) <
                                                    item.price ? 'Koin Kurang' : 'Beli Sekarang' ) }} </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- OTHER PLACEHOLDERS -->

                        <!-- QUIZ (QUEST) PAGE (Formerly Jadwal) -->
                        <div v-if="currentTab === 'jadwal'" key="bounty"
                            class="flex flex-col h-full rounded-2xl bg-white/90 backdrop-blur-sm p-6 shadow-sm border border-slate-100">
                            <div class="flex justify-between items-center mb-6">
                                <div>
                                    <h2 class="text-xl font-bold text-slate-800">Papan Misi (Bounty Board)</h2>
                                    <p class="text-sm text-slate-500">Buat misi untuk siswa dan berikan hadiah.</p>
                                </div>
                                <button @click="openCreateBountyModal"
                                    class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-bold shadow-lg shadow-blue-500/20 transition-all flex items-center gap-2">
                                    <i class="fas fa-plus"></i> Buat Misi Baru
                                </button>
                            </div>

                            <!-- Tabs for Bounty: Active vs Submissions -->
                            <div class="flex gap-4 border-b border-slate-100 mb-6">
                                <button @click="bountyTab = 'active'"
                                    class="pb-2 px-1 text-sm font-medium transition-colors border-b-2"
                                    :class="bountyTab === 'active' ? 'border-blue-600 text-blue-600' : 'border-transparent text-slate-500 hover:text-slate-700'">
                                    Misi Aktif
                                </button>
                                <button @click="bountyTab = 'submissions'"
                                    class="pb-2 px-1 text-sm font-medium transition-colors border-b-2"
                                    :class="bountyTab === 'submissions' ? 'border-blue-600 text-blue-600' : 'border-transparent text-slate-500 hover:text-slate-700'">
                                    Submission Masuk <span v-if="pendingSubmissionsCount > 0"
                                        class="ml-1 bg-red-500 text-white text-[10px] px-1.5 py-0.5 rounded-full">{{
                                        pendingSubmissionsCount }}</span>
                                </button>
                            </div>

                            <!-- Content: Active Bounties -->
                            <div v-if="bountyTab === 'active'"
                                class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 overflow-y-auto pb-4">
                                <div v-if="bounties.length === 0"
                                    class="col-span-full text-center py-12 text-slate-400">
                                    <i class="fas fa-clipboard-list text-4xl mb-3 opacity-20"></i>
                                    <p>Belum ada misi yang dibuat.</p>
                                </div>
                                <div v-for="bounty in bounties" :key="bounty.id"
                                    class="bg-white/90 backdrop-blur-sm border border-slate-200 rounded-xl p-5 hover:shadow-md transition-shadow relative overflow-hidden group">
                                    <div
                                        class="absolute top-0 right-0 w-16 h-16 bg-gradient-to-br from-blue-500/10 to-transparent rounded-bl-3xl -mr-4 -mt-4">
                                    </div>

                                    <h3 class="font-bold text-slate-800 text-lg mb-2 pr-8">{{ bounty.title }}</h3>
                                    <p class="text-sm text-slate-500 mb-4 line-clamp-2 min-h-[40px]">{{
                                        bounty.description }}</p>

                                    <div
                                        class="bg-slate-50 rounded-lg p-3 mb-4 flex justify-between items-center text-xs">
                                        <div class="text-center flex-1 border-r border-slate-200">
                                            <div class="text-slate-400 mb-1">XP</div>
                                            <div class="font-bold text-blue-600">+{{ bounty.rewardXP }}</div>
                                        </div>
                                        <div class="text-center flex-1">
                                            <div class="text-slate-400 mb-1">Koin</div>
                                            <div class="font-bold text-yellow-600">+{{ bounty.rewardCoin }}</div>
                                        </div>
                                    </div>

                                    <div class="text-xs text-slate-400 mb-4 flex justify-between items-center">
                                        <span><i class="fas fa-users mr-1"></i> {{ (bounty.takers || []).length || 0 }}
                                            / {{ bounty.maxTakers }} Pengambil</span>
                                        <span :class="bounty.status === 'active' ? 'text-green-500' : 'text-red-500'">{{
                                            bounty.status === 'active' ? 'Aktif' : 'Selesai' }}</span>
                                    </div>

                                    <button @click="deleteBounty(bounty.id)"
                                        class="w-full text-red-500 hover:bg-red-50 py-2 rounded-lg text-xs font-bold transition-colors">
                                        Hapus Misi
                                    </button>
                                </div>
                            </div>

                            <!-- Content: Submissions -->
                            <div v-if="bountyTab === 'submissions'" class="overflow-y-auto pb-4">
                                <!-- Filters for Submissions -->
                                <div class="flex flex-wrap gap-4 mb-6 relative z-10">
                                    <div class="flex-1 min-w-[200px]">
                                        <label class="block text-xs font-bold text-slate-500 mb-1">Cari
                                            Submission</label>
                                        <div class="relative">
                                            <i
                                                class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 text-xs"></i>
                                            <input v-model="submissionFilter.search" type="text"
                                                placeholder="Nama siswa, judul misi..."
                                                class="w-full pl-9 pr-3 py-2 border border-slate-200 rounded-lg text-sm focus:ring-2 focus:ring-blue-100 outline-none transition-all">
                                        </div>
                                    </div>
                                    <div class="w-full md:w-48">
                                        <label class="block text-xs font-bold text-slate-500 mb-1">Status</label>
                                        <div class="flex gap-2">
                                            <select v-model="submissionFilter.status"
                                                class="flex-1 px-3 py-2 border border-slate-200 rounded-lg text-sm focus:ring-2 focus:ring-blue-100 outline-none transition-all">
                                                <option value="all">Semua Status</option>
                                                <option value="pending">Menunggu</option>
                                                <option value="approved">Disetujui</option>
                                                <option value="rejected">Ditolak</option>
                                            </select>
                                            <button @click="printFilteredSubmissions"
                                                class="px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-bold shadow-lg shadow-blue-500/20 hover:bg-blue-700 transition flex items-center gap-2 whitespace-nowrap"
                                                title="Cetak Berdasarkan Filter">
                                                <i class="fas fa-file-pdf"></i> Cetak Rekap
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <div v-if="filteredSubmissions.length === 0" class="text-center py-12 text-slate-400">
                                    <i class="fas fa-search text-4xl mb-3 opacity-20"></i>
                                    <p>Tidak ada submission yang ditemukan.</p>
                                </div>
                                <div class="grid grid-cols-1 gap-4">
                                    <div v-for="submission in filteredSubmissions" :key="submission.id"
                                        class="bg-white/90 backdrop-blur-sm border border-slate-200 rounded-xl p-4 flex flex-col md:flex-row gap-4 items-start md:items-center">
                                        <div class="w-full md:w-32 h-32 bg-slate-100 rounded-lg overflow-hidden flex-shrink-0 cursor-pointer"
                                            @click="viewSubmissionImage(submission)">
                                            <img :src="submission.photoURL" class="w-full h-full object-cover">
                                        </div>
                                        <div class="flex-1 min-w-0">
                                            <div class="flex flex-wrap justify-between items-start mb-1">
                                                <h3 class="font-bold text-slate-800">{{ submission.bountyTitle }}</h3>
                                                <span class="text-xs text-slate-500">{{ formatTime(submission.timestamp)
                                                    }}</span>
                                            </div>
                                            <p class="text-sm text-slate-600 mb-2">Oleh: <span
                                                    class="font-semibold text-blue-600">{{ submission.studentName
                                                    }}</span></p>
                                            <div class="flex items-center gap-2 mb-2">
                                                <a v-if="submission.locationURL" :href="submission.locationURL"
                                                    target="_blank"
                                                    class="text-xs bg-slate-100 px-2 py-1 rounded text-blue-600 hover:bg-blue-50 hover:text-blue-700 truncate max-w-[200px] border border-transparent hover:border-blue-200 transition-all flex items-center"
                                                    :title="submission.locationText">
                                                    <i class="fas fa-map-marker-alt text-red-500 mr-1"></i> {{
                                                    submission.locationText || 'Lihat di Peta' }}
                                                    <i class="fas fa-external-link-alt text-[8px] ml-1 opacity-50"></i>
                                                </a>
                                                <span v-else
                                                    class="text-xs bg-slate-100 px-2 py-1 rounded text-slate-400 truncate max-w-[200px]"
                                                    :title="submission.locationText">
                                                    <i class="fas fa-map-marker-alt text-slate-300 mr-1"></i> {{
                                                    submission.locationText || 'Lokasi tidak tersedia' }}
                                                </span>
                                            </div>
                                            <p v-if="submission.status === 'pending'"
                                                class="text-sm text-yellow-600 font-medium bg-yellow-50 px-2 py-1 rounded inline-block">
                                                <i class="fas fa-clock mr-1"></i> Menunggu Konfirmasi
                                            </p>
                                            <p v-else-if="submission.status === 'approved'"
                                                class="text-sm text-green-600 font-medium bg-green-50 px-2 py-1 rounded inline-block">
                                                <i class="fas fa-check mr-1"></i> Disetujui
                                            </p>
                                            <p v-else
                                                class="text-sm text-red-600 font-medium bg-red-50 px-2 py-1 rounded inline-block">
                                                <i class="fas fa-times mr-1"></i> Ditolak
                                            </p>
                                        </div>
                                        <div class="flex gap-2 w-full md:w-auto">
                                            <button @click="openPrintSettings(submission)"
                                                class="flex-1 md:flex-none px-4 py-2 bg-slate-100 text-slate-600 rounded-lg text-sm font-bold hover:bg-slate-200 transition flex items-center gap-2">
                                                <i class="fas fa-file-pdf text-red-500"></i> Cetak
                                            </button>
                                            <template v-if="submission.status === 'pending'">
                                                <button @click="rejectSubmission(submission)"
                                                    class="flex-1 md:flex-none px-4 py-2 bg-red-100 text-red-600 rounded-lg text-sm font-bold hover:bg-red-200 transition">Tolak</button>
                                                <button @click="approveSubmission(submission)"
                                                    class="flex-1 md:flex-none px-4 py-2 bg-green-600 text-white rounded-lg text-sm font-bold hover:bg-green-700 shadow-lg shadow-green-500/20 transition">Setujui</button>
                                            </template>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- OTHER PLACEHOLDERS -->
                        <div v-if="['nilai', 'materi'].includes(currentTab)" key="placeholder-others"
                            class="flex flex-col items-center justify-center h-96 text-center">
                            <div class="bg-slate-100 p-6 rounded-full mb-4">
                                <i class="fas fa-hammer text-4xl text-slate-300"></i>
                            </div>
                            <h3 class="text-xl font-bold text-slate-600">Fitur Sedang Dibangun</h3>
                            <p class="text-slate-400">Tukang sedang bekerja, harap kembali lagi nanti.</p>
                        </div>

                    </transition>

                    <!-- Footer -->
                    <footer class="mt-auto py-6 text-center border-t border-slate-200/60">
                        <p class="text-xs text-slate-400 font-medium">
                            &copy; 2026 SMKMYCKB. All rights reserved.
                            <span class="mx-2">‚Ä¢</span>
                            Built by <b class="text-slate-500">Mas Panji Purnomo</b>
                        </p>
                    </footer>

                </div>
            </div>
        </main>

        <!-- Skill Target Modal -->
        <transition name="fade">
            <div v-if="isSkillModalOpen"
                class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-900/50 backdrop-blur-sm">
                <div
                    class="bg-white/90 backdrop-blur-sm rounded-2xl shadow-xl w-full max-w-md overflow-hidden transform transition-all">
                    <div class="p-6 border-b border-slate-100 flex justify-between items-center bg-slate-50">
                        <h3 class="font-bold text-lg text-slate-800">
                            Gunakan Skill: <span :class="`text-${selectedSkill?.color}-600`">{{ selectedSkill?.name
                                }}</span>
                        </h3>
                        <button @click="isSkillModalOpen = false"
                            class="text-slate-400 hover:text-slate-600 transition">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="p-4">
                        <p class="text-sm text-slate-600 mb-4">{{ selectedSkill?.desc }}</p>

                        <label class="block text-xs font-bold text-slate-500 mb-2">Pilih Target Siswa:</label>
                        <div v-if="students.length === 0"
                            class="text-center p-4 bg-red-50 text-red-500 rounded text-sm mb-4">
                            <i class="fas fa-exclamation-circle mr-1"></i> Data siswa kosong. Pilih kelas di menu
                            Absensi dulu.
                        </div>
                        <div v-else class="max-h-60 overflow-y-auto space-y-2 border border-slate-100 rounded-lg p-2">
                            <div v-for="student in students" :key="student.uid" @click="castSkillOnStudent(student.uid)"
                                class="p-3 hover:bg-slate-50 cursor-pointer rounded-lg border border-transparent hover:border-slate-200 flex justify-between items-center transition">
                                <div>
                                    <div class="font-bold text-sm text-slate-800">{{ student.name }}</div>
                                    <div class="text-[10px] text-slate-400">XP: {{ student.xp || 0 }} | HP: {{
                                        student.hp || 0 }}</div>
                                </div>
                                <button
                                    class="bg-blue-600 hover:bg-blue-700 text-white text-xs px-3 py-1.5 rounded-lg shadow font-medium">
                                    Pilih
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </transition>

        <!-- Teacher Chat Modal -->
        <transition name="fade">
            <div v-if="isTeacherChatOpen"
                class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-900/50 backdrop-blur-sm">
                <div
                    class="bg-white/90 backdrop-blur-sm rounded-2xl shadow-xl w-full max-w-4xl h-[80vh] flex overflow-hidden border border-slate-200">

                    <!-- Sidebar (Recipients) -->
                    <div class="w-1/3 border-r border-slate-100 flex flex-col bg-slate-50">
                        <div class="p-4 border-b border-slate-100 bg-white/90 backdrop-blur-sm">
                            <h3 class="font-bold text-slate-800 mb-2">Pigeon Post</h3>
                            <input v-model="chatSearchQuery" type="text" placeholder="Cari Siswa..."
                                class="w-full px-3 py-2 bg-slate-100 border-none rounded-lg text-sm focus:ring-2 focus:ring-blue-100 transition-all">
                        </div>

                        <div class="flex-1 overflow-y-auto">
                            <div v-if="filteredChatRecipients.length === 0"
                                class="p-4 text-center text-slate-400 text-sm">
                                Tidak ada siswa ditemukan.
                            </div>
                            <div v-for="recipient in filteredChatRecipients" :key="recipient.uid"
                                @click="selectChatRecipient(recipient)"
                                class="p-3 border-b border-slate-100 cursor-pointer hover:bg-white/90 backdrop-blur-sm transition-colors flex items-center gap-3 relative"
                                :class="currentChatRecipient?.uid === recipient.uid ? 'bg-white/90 backdrop-blur-sm border-l-4 border-l-blue-500 shadow-sm' : ''">

                                <div class="relative">
                                    <img :src="recipient.photoURL || `https://api.dicebear.com/7.x/avataaars/svg?seed=${recipient.name}`"
                                        class="w-10 h-10 rounded-full bg-slate-200 border border-white shadow-sm">
                                    <span v-if="recipient.unreadCount > 0"
                                        class="absolute -top-1 -right-1 bg-red-500 text-white text-[10px] font-bold w-4 h-4 rounded-full flex items-center justify-center ring-2 ring-white">
                                        {{ recipient.unreadCount }}
                                    </span>
                                </div>

                                <div class="flex-1 min-w-0">
                                    <div class="flex justify-between items-baseline">
                                        <h4 class="font-bold text-slate-700 text-sm truncate">{{ recipient.name }}</h4>
                                        <span class="text-[10px] text-slate-400">{{
                                            formatTime(recipient.lastMessageTime) }}</span>
                                    </div>
                                    <p class="text-xs text-slate-500 truncate mt-0.5"
                                        :class="recipient.unreadCount > 0 ? 'font-bold text-slate-700' : ''">
                                        {{ recipient.lastMessage }}
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Chat Area -->
                    <div class="flex-1 flex flex-col bg-white/90 backdrop-blur-sm relative">
                        <!-- Header -->
                        <div class="p-4 border-b border-slate-100 flex justify-between items-center shadow-sm z-10">
                            <div v-if="currentChatRecipient" class="flex items-center gap-3">
                                <img :src="currentChatRecipient.photoURL || `https://api.dicebear.com/7.x/avataaars/svg?seed=${currentChatRecipient.name}`"
                                    class="w-8 h-8 rounded-full border border-slate-100">
                                <div>
                                    <h4 class="font-bold text-slate-800 text-sm">{{ currentChatRecipient.name }}</h4>
                                    <p class="text-[10px] text-slate-500">{{ currentChatRecipient.role || 'Siswa' }}</p>
                                </div>
                            </div>
                            <div v-else class="text-slate-400 text-sm font-medium">Pilih siswa untuk memulai chat</div>

                            <button @click="toggleTeacherChat"
                                class="text-slate-400 hover:text-red-500 transition-colors p-2">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>

                        <!-- Messages -->
                        <div class="flex-1 overflow-y-auto p-4 space-y-4 bg-slate-50/50" id="teacher-chat-messages">
                            <div v-if="!currentChatRecipient"
                                class="h-full flex flex-col items-center justify-center text-slate-300">
                                <i class="fas fa-dove text-6xl mb-4 opacity-20"></i>
                                <p>Pigeon Post System</p>
                            </div>

                            <template v-else>
                                <div v-if="currentChatMessages.length === 0"
                                    class="text-center py-10 text-slate-400 text-sm">
                                    Belum ada pesan. Sapa siswa ini!
                                </div>
                                <div v-for="msg in currentChatMessages" :key="msg.id" class="flex flex-col max-w-[80%]"
                                    :class="msg.senderId === user.uid ? 'ml-auto items-end' : 'items-start'">

                                    <div class="p-3 rounded-2xl text-sm relative group shadow-sm"
                                        :class="msg.senderId === user.uid ? 'bg-blue-600 text-white rounded-br-none' : 'bg-white/90 backdrop-blur-sm text-slate-700 border border-slate-100 rounded-bl-none'">
                                        {{ msg.text }}
                                        <div class="text-[9px] mt-1 opacity-70 flex items-center justify-end gap-1">
                                            {{ formatTime(msg.timestamp) }}
                                            <span v-if="msg.senderId === user.uid">
                                                <i class="fas" :class="msg.read ? 'fa-check-double' : 'fa-check'"></i>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </template>
                        </div>

                        <!-- Input -->
                        <div class="p-4 border-t border-slate-100 bg-white/90 backdrop-blur-sm">
                            <form @submit.prevent="sendChatMessage" class="flex gap-2">
                                <input v-model="chatInput" type="text" placeholder="Tulis pesan..."
                                    :disabled="!currentChatRecipient"
                                    class="flex-1 px-4 py-2 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 disabled:opacity-50 transition-all">
                                <button type="submit" :disabled="!currentChatRecipient || !chatInput.trim()"
                                    class="bg-blue-600 hover:bg-blue-700 disabled:bg-slate-300 text-white p-2 w-10 h-10 rounded-lg flex items-center justify-center transition-all shadow-md active:scale-95">
                                    <i class="fas fa-paper-plane text-sm"></i>
                                </button>
                            </form>
                        </div>
                    </div>

                </div>
            </div>
        </transition>

        <!-- Profile Modal -->
        <transition name="fade">
            <div v-if="isProfileModalOpen"
                class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-900/50 backdrop-blur-sm">
                <div
                    class="bg-white/90 backdrop-blur-sm rounded-2xl shadow-xl w-full max-w-2xl overflow-hidden transform transition-all">
                    <div class="p-6 border-b border-slate-100 flex justify-between items-center bg-slate-50">
                        <h3 class="font-bold text-lg text-slate-800">Edit Profil Guru</h3>
                        <button @click="closeProfileModal" class="text-slate-400 hover:text-slate-600 transition">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>

                    <div class="p-6 max-h-[70vh] overflow-y-auto">
                        <div class="text-center mb-6">
                            <div class="relative w-24 h-24 mx-auto mb-3">
                                <img :src="editForm.photoBase64 || `https://api.dicebear.com/7.x/avataaars/svg?seed=${editForm.avatar_seed || 'Teacher'}`"
                                    class="w-full h-full rounded-full object-cover border-4 border-white shadow-lg bg-white/90 backdrop-blur-sm">
                                <button @click="startCamera"
                                    class="absolute bottom-0 right-0 bg-blue-600 text-white p-2 rounded-full shadow-md hover:bg-blue-700 transition"
                                    title="Ambil Foto">
                                    <i class="fas fa-camera text-xs"></i>
                                </button>
                            </div>
                            <div class="flex justify-center gap-2">
                                <button @click="regenerateAvatar"
                                    class="text-xs px-3 py-1 bg-slate-100 text-slate-600 rounded-full hover:bg-slate-200 transition">
                                    <i class="fas fa-dice mr-1"></i> Random Avatar
                                </button>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-xs font-bold text-slate-500 mb-1">Nama Lengkap</label>
                                <input v-model="editForm.name" type="text"
                                    class="w-full px-3 py-2 border border-slate-200 rounded-lg text-sm focus:ring-blue-500 focus:border-blue-500">
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-slate-500 mb-1">NIP / NIY</label>
                                <input v-model="editForm.niy" type="text"
                                    class="w-full px-3 py-2 border border-slate-200 rounded-lg text-sm focus:ring-blue-500 focus:border-blue-500">
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-slate-500 mb-1">Jenis Kelamin</label>
                                <select v-model="editForm.gender"
                                    class="w-full px-3 py-2 border border-slate-200 rounded-lg text-sm focus:ring-blue-500 focus:border-blue-500">
                                    <option value="L">Laki-laki</option>
                                    <option value="P">Perempuan</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-slate-500 mb-1">Tanggal Lahir</label>
                                <input v-model="editForm.dob" type="date"
                                    class="w-full px-3 py-2 border border-slate-200 rounded-lg text-sm focus:ring-blue-500 focus:border-blue-500">
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-slate-500 mb-1">Jabatan / Mapel</label>
                                <input v-model="editForm.role_detail" type="text"
                                    class="w-full px-3 py-2 border border-slate-200 rounded-lg text-sm focus:ring-blue-500 focus:border-blue-500">
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-slate-500 mb-1">No. HP</label>
                                <input v-model="editForm.phone" type="text"
                                    class="w-full px-3 py-2 border border-slate-200 rounded-lg text-sm focus:ring-blue-500 focus:border-blue-500">
                            </div>
                            <div class="col-span-1 md:col-span-2">
                                <label class="block text-xs font-bold text-slate-500 mb-1">Alamat</label>
                                <textarea v-model="editForm.address" rows="2"
                                    class="w-full px-3 py-2 border border-slate-200 rounded-lg text-sm focus:ring-blue-500 focus:border-blue-500"></textarea>
                            </div>
                        </div>
                    </div>

                    <div class="p-4 bg-slate-50 border-t border-slate-100 flex justify-end gap-3">
                        <button @click="closeProfileModal"
                            class="px-4 py-2 text-sm font-medium text-slate-500 hover:text-slate-700 hover:bg-slate-200 rounded-lg transition">Batal</button>
                        <button @click="saveProfile"
                            class="px-4 py-2 text-sm font-bold text-white bg-blue-600 hover:bg-blue-700 rounded-lg shadow-lg shadow-blue-500/30 transition">Simpan
                            Perubahan</button>
                    </div>
                </div>
            </div>
        </transition>

        <!-- Camera Modal -->
        <transition name="fade">
            <div v-if="isCameraModalOpen"
                class="fixed inset-0 z-[60] flex items-center justify-center bg-black/90 cursor-auto">
                <div
                    class="relative w-full max-w-lg bg-black rounded-xl overflow-hidden shadow-2xl border border-slate-800">
                    <video ref="videoRef" autoplay playsinline class="w-full h-64 md:h-96 object-cover bg-black"
                        :class="{'hidden': photoPreview}"></video>
                    <canvas ref="canvasRef" class="hidden"></canvas>
                    <img v-if="photoPreview" :src="photoPreview" class="w-full h-64 md:h-96 object-cover">

                    <div
                        class="absolute bottom-0 inset-x-0 p-6 flex justify-center items-center gap-4 bg-gradient-to-t from-black/80 to-transparent">
                        <div v-if="!photoPreview">
                            <button @click="stopCamera"
                                class="absolute left-6 text-white text-sm hover:text-slate-300">Batal</button>
                            <button @click="takePhoto"
                                class="w-16 h-16 rounded-full border-4 border-white flex items-center justify-center hover:bg-white/90 backdrop-blur-sm/20 transition active:scale-95">
                                <div class="w-12 h-12 bg-white/90 backdrop-blur-sm rounded-full"></div>
                            </button>
                        </div>
                        <div v-else class="flex gap-4">
                            <button @click="retakePhoto"
                                class="px-6 py-2 bg-slate-600 text-white rounded-full font-bold hover:bg-slate-500">Ulangi</button>
                            <button @click="savePhoto"
                                class="px-6 py-2 bg-blue-600 text-white rounded-full font-bold hover:bg-blue-500 shadow-lg shadow-blue-500/50">Gunakan
                                Foto</button>
                        </div>
                    </div>
                </div>
            </div>
        </transition>

        <!-- Create Bounty Modal -->
        <transition name="fade">
            <div v-if="isCreateBountyModalOpen"
                class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-900/50 backdrop-blur-sm">
                <div
                    class="bg-white/90 backdrop-blur-sm rounded-2xl shadow-xl w-full max-w-lg overflow-hidden transform transition-all">
                    <div class="p-6 border-b border-slate-100 flex justify-between items-center bg-slate-50">
                        <h3 class="font-bold text-lg text-slate-800">Buat Misi Baru</h3>
                        <button @click="isCreateBountyModalOpen = false"
                            class="text-slate-400 hover:text-slate-600 transition">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="p-6 max-h-[70vh] overflow-y-auto">
                        <div class="grid grid-cols-1 gap-4">
                            <!-- Image Upload -->
                            <div class="mb-2">
                                <label class="block text-xs font-bold text-slate-500 mb-1">Gambar Misi</label>
                                <div class="flex items-center gap-4">
                                    <div v-if="newBounty.imageUrl"
                                        class="relative w-24 h-16 rounded-lg overflow-hidden border border-slate-200 group">
                                        <img :src="newBounty.imageUrl" class="w-full h-full object-cover">
                                        <button @click="newBounty.imageUrl = null"
                                            class="absolute top-1 right-1 bg-red-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs opacity-0 group-hover:opacity-100 transition"><i
                                                class="fas fa-times"></i></button>
                                    </div>
                                    <div class="flex-1">
                                        <input type="file" @change="handleBountyImageUpload" accept="image/*"
                                            class="block w-full text-sm text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-xs file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100 transition" />
                                        <p class="text-[10px] text-slate-400 mt-1">Format: JPG, PNG. Max 2MB.</p>
                                    </div>
                                </div>
                            </div>

                            <div>
                                <label class="block text-xs font-bold text-slate-500 mb-1">Judul Misi</label>
                                <input v-model="newBounty.title" type="text"
                                    placeholder="Contoh: Shalat Subuh Berjamaah"
                                    class="w-full px-3 py-2 border border-slate-200 rounded-lg text-sm focus:ring-blue-500 focus:border-blue-500">
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-slate-500 mb-1">Tipe Misi</label>
                                <select v-model="newBounty.type"
                                    class="w-full px-3 py-2 border border-slate-200 rounded-lg text-sm focus:ring-blue-500 focus:border-blue-500">
                                    <option value="general">Umum</option>
                                    <option value="pesantren_ekologi">Pesantren Ekologi</option>
                                    <option value="academic">Akademik</option>
                                    <option value="social">Sosial</option>
                                </select>
                            </div>
                            <div v-if="newBounty.type === 'pesantren_ekologi'">
                                <label class="block text-xs font-bold text-slate-500 mb-1">Kategori Kegiatan</label>
                                <select v-model="newBounty.category"
                                    class="w-full px-3 py-2 border border-slate-200 rounded-lg text-sm focus:ring-blue-500 focus:border-blue-500">
                                    <option value="shalat_subuh">Shalat Subuh</option>
                                    <option value="tahajud">Shalat Tahajud</option>
                                    <option value="duha">Shalat Duha</option>
                                    <option value="kebersihan">Kebersihan Lingkungan</option>
                                    <option value="kajian">Kajian Islam</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-slate-500 mb-1">Deskripsi</label>
                                <textarea v-model="newBounty.description" rows="3" placeholder="Jelaskan detail misi..."
                                    class="w-full px-3 py-2 border border-slate-200 rounded-lg text-sm focus:ring-blue-500 focus:border-blue-500"></textarea>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-xs font-bold text-slate-500 mb-1">Hadiah XP</label>
                                    <input v-model.number="newBounty.rewardXP" type="number"
                                        class="w-full px-3 py-2 border border-slate-200 rounded-lg text-sm focus:ring-blue-500 focus:border-blue-500">
                                </div>
                                <div>
                                    <label class="block text-xs font-bold text-slate-500 mb-1">Hadiah Koin</label>
                                    <input v-model.number="newBounty.rewardCoin" type="number"
                                        class="w-full px-3 py-2 border border-slate-200 rounded-lg text-sm focus:ring-blue-500 focus:border-blue-500">
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-xs font-bold text-slate-500 mb-1">Batas Peserta</label>
                                    <input v-model.number="newBounty.maxTakers" type="number"
                                        class="w-full px-3 py-2 border border-slate-200 rounded-lg text-sm focus:ring-blue-500 focus:border-blue-500">
                                </div>
                                <div>
                                    <label class="block text-xs font-bold text-slate-500 mb-1">Batas Waktu</label>
                                    <input v-model="newBounty.deadline" type="date"
                                        class="w-full px-3 py-2 border border-slate-200 rounded-lg text-sm focus:ring-blue-500 focus:border-blue-500">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="p-4 bg-slate-50 border-t border-slate-100 flex justify-end gap-3">
                        <button @click="isCreateBountyModalOpen = false"
                            class="px-4 py-2 text-sm font-medium text-slate-500 hover:text-slate-700 hover:bg-slate-200 rounded-lg transition">Batal</button>
                        <button @click="createBounty"
                            class="px-4 py-2 text-sm font-bold text-white bg-blue-600 hover:bg-blue-700 rounded-lg shadow-lg shadow-blue-500/30 transition">Buat
                            Misi</button>
                    </div>
                </div>
            </div>
        </transition>

        <!-- Print Settings Modal -->
        <transition name="fade">
            <div v-if="isPrintSettingsModalOpen && selectedSubmission"
                class="fixed inset-0 z-[60] flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-sm">
                <div
                    class="bg-white/90 backdrop-blur-sm rounded-2xl shadow-2xl w-full max-w-md overflow-hidden transform transition-all border border-slate-200">
                    <div class="p-6 border-b border-slate-100 flex justify-between items-center bg-slate-50">
                        <div class="flex items-center gap-3">
                            <div
                                class="w-10 h-10 rounded-xl bg-blue-100 flex items-center justify-center text-blue-600">
                                <i class="fas fa-file-pdf"></i>
                            </div>
                            <h3 class="font-bold text-lg text-slate-800">Pengaturan Cetak</h3>
                        </div>
                        <button @click="isPrintSettingsModalOpen = false"
                            class="text-slate-400 hover:text-red-500 transition-colors p-2">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>

                    <div class="p-6">
                        <p class="text-sm text-slate-500 mb-6">Pilih data yang ingin Anda sertakan dalam laporan PDF
                            ini.</p>

                        <div class="space-y-4">
                            <label v-for="(val, key) in printSettings" :key="key"
                                class="flex items-center justify-between p-3 bg-slate-50 rounded-xl border border-slate-100 cursor-pointer hover:bg-white/90 backdrop-blur-sm hover:border-blue-200 transition-all group">
                                <div class="flex items-center gap-3">
                                    <div
                                        class="p-2 rounded-lg bg-white/90 backdrop-blur-sm shadow-sm border border-slate-100 text-slate-400 group-hover:text-blue-500 transition-colors">
                                        <i class="fas" :class="{
                                            'fa-camera': key === 'showPhoto',
                                            'fa-user': key === 'showName',
                                            'fa-id-card': key === 'showClass',
                                            'fa-bullseye': key === 'showTitle',
                                            'fa-clock': key === 'showDate',
                                            'fa-map-marker-alt': key === 'showLocation',
                                            'fa-align-left': key === 'showDescription'
                                        }"></i>
                                    </div>
                                    <span class="text-sm font-semibold text-slate-700 capitalize">
                                        {{ key.replace('show', '').replace(/([A-Z])/g, ' $1').trim() }}
                                    </span>
                                </div>
                                <input type="checkbox" v-model="printSettings[key]"
                                    class="w-5 h-5 rounded text-blue-600 focus:ring-blue-500">
                            </label>
                        </div>
                    </div>

                    <div class="p-4 bg-slate-50 border-t border-slate-100 flex gap-3">
                        <button @click="isPrintSettingsModalOpen = false"
                            class="flex-1 px-4 py-3 bg-white/90 backdrop-blur-sm border border-slate-200 text-slate-600 rounded-xl text-sm font-bold hover:bg-slate-100 transition">Batal</button>
                        <button @click="exportToPDF(selectedSubmission); isPrintSettingsModalOpen = false"
                            class="flex-1 px-4 py-3 bg-blue-600 text-white rounded-xl text-sm font-bold hover:bg-blue-700 shadow-lg shadow-blue-500/20 transition-all active:scale-95">
                            Cetak PDF
                        </button>
                    </div>
                </div>
            </div>
        </transition>

        <!-- View Submission Modal -->
        <transition name="fade">
            <div v-if="isSubmissionModalOpen && selectedSubmission"
                class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-900/50 backdrop-blur-sm">
                <div
                    class="bg-white/90 backdrop-blur-sm rounded-2xl shadow-xl w-full max-w-2xl overflow-hidden transform transition-all flex flex-col md:flex-row h-[80vh] md:h-auto">

                    <div class="w-full md:w-1/2 bg-black flex items-center justify-center relative">
                        <img :src="selectedSubmission.photoURL"
                            class="max-h-[50vh] md:max-h-[80vh] w-full object-contain">
                        <div class="absolute top-4 left-4">
                            <span class="bg-black/50 text-white px-2 py-1 rounded text-xs backdrop-blur-sm">
                                <i class="fas fa-camera mr-1"></i> Bukti Foto
                            </span>
                        </div>
                    </div>

                    <div class="w-full md:w-1/2 flex flex-col h-full bg-white/90 backdrop-blur-sm">
                        <div class="p-6 border-b border-slate-100 flex justify-between items-center bg-slate-50">
                            <div class="flex items-center gap-3">
                                <h3 class="font-bold text-lg text-slate-800">Detail Submission</h3>
                                <button @click="openPrintSettings(selectedSubmission)"
                                    class="flex items-center gap-2 px-3 py-1.5 bg-white/90 backdrop-blur-sm border border-slate-200 rounded-lg text-xs font-bold text-slate-600 hover:bg-slate-50 hover:text-blue-600 transition shadow-sm">
                                    <i class="fas fa-file-pdf text-red-500"></i>
                                    Cetak PDF
                                </button>
                            </div>
                            <button @click="isSubmissionModalOpen = false"
                                class="text-slate-400 hover:text-slate-600 transition">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>

                        <div class="p-6 flex-1 overflow-y-auto">
                            <div class="mb-6">
                                <div class="flex items-center gap-3 mb-2">
                                    <img :src="selectedSubmission.studentPhoto || `https://api.dicebear.com/7.x/avataaars/svg?seed=${selectedSubmission.studentName}`"
                                        class="w-10 h-10 rounded-full border border-slate-200">
                                    <div>
                                        <div class="font-bold text-slate-800">{{ selectedSubmission.studentName }}</div>
                                        <div class="text-xs text-slate-500">{{ formatTime(selectedSubmission.timestamp)
                                            }}</div>
                                    </div>
                                </div>
                            </div>

                            <div class="mb-4">
                                <label class="block text-xs font-bold text-slate-500 mb-1">Misi</label>
                                <p class="text-sm font-semibold text-slate-800">{{ selectedSubmission.bountyTitle }}</p>
                            </div>

                            <div class="mb-4">
                                <label class="block text-xs font-bold text-slate-500 mb-1">Lokasi</label>
                                <a :href="selectedSubmission.locationURL" target="_blank"
                                    class="text-blue-600 text-sm hover:underline flex items-center gap-1 bg-blue-50 p-2 rounded-lg border border-blue-100">
                                    <i class="fas fa-map-marker-alt text-red-500"></i>
                                    {{ selectedSubmission.locationText || 'Lihat di Peta' }}
                                    <i class="fas fa-external-link-alt text-xs ml-auto"></i>
                                </a>
                            </div>

                            <div class="mb-4">
                                <label class="block text-xs font-bold text-slate-500 mb-1">Deskripsi Kegiatan</label>
                                <div
                                    class="bg-slate-50 p-3 rounded-lg border border-slate-100 text-sm text-slate-700 italic">
                                    "{{ selectedSubmission.description }}"
                                </div>
                            </div>
                        </div>

                        <div class="p-4 bg-slate-50 border-t border-slate-100 flex gap-3"
                            v-if="selectedSubmission.status === 'pending'">
                            <button @click="rejectSubmission(selectedSubmission)"
                                class="flex-1 px-4 py-2 bg-red-100 text-red-600 rounded-lg text-sm font-bold hover:bg-red-200 transition">Tolak</button>
                            <button @click="approveSubmission(selectedSubmission)"
                                class="flex-1 px-4 py-2 bg-green-600 text-white rounded-lg text-sm font-bold hover:bg-green-700 shadow-lg shadow-green-500/20 transition">Setujui</button>
                        </div>
                        <div class="p-4 bg-slate-50 border-t border-slate-100 text-center font-bold" v-else>
                            <span :class="selectedSubmission.status === 'approved' ? 'text-green-600' : 'text-red-600'">
                                {{ selectedSubmission.status === 'approved' ? 'Sudah Disetujui' : 'Sudah Ditolak' }}
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </transition>

    </div>

    <!-- Script Module -->
    <script type="module" src="./teacher.js"></script>
</body>

</html>
